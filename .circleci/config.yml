version: 2.1

jobs:

  integration-postgres:
    docker:
      - image: cimg/python:3.9.9
      - image: circleci/postgres:9.6.5-alpine-ram

    steps:
      - checkout
      - run:
          name: Install Python packages
          command: |
            python3 -m venv venv
            . venv/bin/activate
            pip install -U pip wheel
            pip install dbt-core dbt-postgres dbt-bigquery dbt-snowflake

      - run:
          name: "Run Tests - Postgres"
          environment:
            POSTGRES_TEST_HOST: localhost
            POSTGRES_TEST_USER: root
            POSTGRES_TEST_PASS: ''
            POSTGRES_TEST_PORT: 5432
            POSTGRES_TEST_DBNAME: postgres
          command: dbt build -t postgres
      - store_artifacts:
          path: ./logs

workflows:
  version: 2
  test-all:
    jobs:
      - integration-postgres
